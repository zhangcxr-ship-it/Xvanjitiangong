[TOC]

# 理论知识

## C语言

### 第一个C语言程序

— vs2022的一些最最基础的功能和用法
1 在空白项目里面新建一个 c或c嘎嘎的文件
方法：找到解决方案资源管理器 若找不到则在视图里找 对相应的文件右键 在添加选项里找的新建项 选择c或者cpp
2 找到代码里面的语法错误
方法：在生成里面找到 生成解决方案或者重新生成解决方案 会报出错误位置以及改错方法 直接双击错误
找到错误位置并改正
3 运行代码
方法：在调试里面找到开始执行的选项
语法错误是根本无法运行 逻辑错误能运行但是结果离谱
代码写在main里面

### C语言中的关键字和标识符

![image-20251026102727576](E:\Typora\Theoretical knowledge.assets\image-20251026102727576.png)

告诉计算机要操作的数据，控制源代码运行，可能与命令类似

![image-20251026102908646](E:\Typora\Theoretical knowledge.assets\image-20251026102908646.png)

标识符：某个实体的名字

命名规则与规范:

1.只能由字母 数字 下划线_组成
2 .数字不能作为首字母
3 .不能和关键字相同
4 .有长度限制
5 .区分大小写
6 .合理冠名

### C语言的基本数据类型

![image-20251026103149090](E:\Typora\Theoretical knowledge.assets\image-20251026103149090.png)

在c语言中 不仅关心数值的大小 还关心所占内存的多少
sizeof（）是求括号里内容占内存的多少 %d表示输出为整型 %c表示输出为一个字符
字符是通过ascii码和整型对应 所以在一定情况下 字符能被当成整型使用

### 常量与变量

常量：不能被修改的数据

变量：可以被修改的

常量给变量赋值

![image-20251026103328765](E:\Typora\Theoretical knowledge.assets\image-20251026103328765.png)

变量
首先变量需要定义才能够使用
定义方法 数据类型（基本数据类型）标识符= ；
printf（） 控制台输出函数 在圆括号内给出格式化字符串 具体详见project2
unsigned使变量无符号位 就是没办法识别成负数
常变量 通过const修饰来定义      const 数据类型（基本数据类型）标识符=；
常变量只能初始化赋值 后期无法重复赋值

### 运算符

![image-20251026104158301](E:\Typora\Theoretical knowledge.assets\image-20251026104158301.png)

![image-20251026104309728](E:\Typora\Theoretical knowledge.assets\image-20251026104309728.png)![image-20251026104340017](E:\Typora\Theoretical knowledge.assets\image-20251026104340017.png)在自加运算中有++age age++两种写法 在分![image-20251026104357209](E:\Typora\Theoretical knowledge.assets\image-20251026104357209.png)![image-20251026104415020](E:\Typora\Theoretical knowledge.assets\image-20251026104415020.png)![image-20251026104434871](E:\Typora\Theoretical knowledge.assets\image-20251026104434871.png)行写的时候无影响 而在写连式时有影响 先++是先加再赋值
后++反之 自减与自加相同
对于数学上的取值范围 必须通过逻辑运算来实现
计算机默认表示真假操作 非0为真 0为假
位左移相当于乘2的n次幂 位右移相当于整除2的n次幂

### 表达式和语句的基本概念

表达式
定义：表达式是通过运算符联系标量和常量的语法结构
注意：1.表达式的操作数据类型必须保持一致 当数据操作类型不一致时会发生类型转换
类型转换分为两种：（1）自动转换:小类型转换为大类型
（2）强制转换：大类型转化为小类型 （类型名称）这种就是类型转化的写法
在一些情况 强制转化会造成数据丢失
判断类型转化的依据 1.通过内存大小来判断 2.通过取值范围的大小来判断
如 int 和float 均为4字节的存储大小 但是float的取值范围更大
语句
语句定义：一行行代码 通过；来结尾（丐版定义）
一条条指令，计算机通过执行语句来实现程序运行
语句分类

![image-20251026105040317](E:\Typora\Theoretical knowledge.assets\image-20251026105040317.png)

scanf 格式化输入函数
使用方式 scanf（"", &""）；""内输入格式化字符串 ""表示输入的对象
注意：1.在要输入的变量前加&
2.输入多个数据 本身自身就自带结束符 所以在""内尽量不要有别的字符 结束符默认为空格和回车
可能会导致结束符改变

### if语句

if语句是选择语句的一种
if（）圆括号里面一般跟逻辑表达式和关系表达式 少数情况跟算数表达式 算数表达式中 0为假 非0即为真
if后可跟简单语句或者复合语句 复合语句要用花括号括起来 （花括号可以保证逻辑严密更清晰）
if else 如果 否则
注意：1.else不能够独立存在
2.else和if使用方法类似
if else if 多分支执行
用if else的嵌套也可以实现 嵌套就是花括号里面再嵌套语句

### switch语句

switch case语句
语法结构 switch（算术表达式或者单个变量）
{case1:
              break
case2:
              break
case3:
              break
default:
              break
}
执行流程：switch语句适合于精确的值的表达式和变量 根据圆括号里面的内容 定位到满足条件的case中
进入程序执行 case相当于入口 break相当于休止 即为遇到break程序才会停止 如果变量不满足所有case
的情况 则会执行default
可以用运算操作来提取变量共性 把范围值转化为数值进而采用switch语句
可以用多个case就是多个入口来进入程序编写

### 循环语句

![image-20251026105546831](E:\Typora\Theoretical knowledge.assets\image-20251026105546831.png)

for语句
语法结构 for（指定操作的变量 计数变量；判断循环是非进行的条件；对变量执行的操作）
{
循环体
}
执行流程：表达式1-》表达式2-》循环体-》表达式3-》表达式2-》循环体……如此反复
当表达式2里面的是真时 则继续进行 假则结束
其中表达式1和3如果是空语句的话则表示啥也不做
表达式2是空的话则是无线循环
while语句
语法结构：提前定义好计数器
while（逻辑或关系表达式）
{
循环体 需要在循环体内部做好计数器的修改
}
do while 语句
语法结构 do
{循环体
}
while（关系或逻辑表达式）；
while和do while 的执行方式和for语句相似
while和for语句while或者for后面不加；
do while 需要加上；
while for都是先判断后执行 而do while则是先执行后判断 所以在一些情况下 同样条件 do while会比for多进行一次

### 跳转语句及嵌套语句

跳转
1.break（跳出）
break可用作于switch case语句的结束 也可以用于for等循环语句的结束 但是它仅是跳出且终止一重循环
用法就是在语句后跟上break；就相当于用上break 就不再进行循环了
2.continue（跳转）
跳转语句只用于循环中 结束当前循环直接进行下一循环 但是在for中是回到表达式3再回到循环处
用上continue是把当前此的循环跳过开启下一循环
用法continue；
3.goto（无条件转移）
MYLAB：是标号 用冒号来修饰 搭配goto如同飞雷神 跳到标号的位置 从上往下运行
goto可以跳出多重循环（建议）
不过慎用 否则容易导致代码混乱
控制语句嵌套
把控制语句当成一个普通语句 一层一层的进行执行
通过break来跳出嵌套语句 可通过定义中间变量再加上if条件执行加上break来跳出

### 数组

定义：固定大小（指的是内存大小）的相同类型元素的顺序集合
一维数组（n个相同类型的数据集合）
定义方式：数据类型 加表示符加[]括号内就是该数组的个数n []这个括号内必须是常量或者常量表达式
注意：[0]这里代表的是数组的第一个数据 每一个1实际上是内存大小 如一个int类型 4字节 0到1实际上是跳了4个字节 一种单位类型的1
下标访问 通过[]里的数字来访问数组里面的数据
初始化
在c语言中初始化是必要的 否则会导致无法运行 是内存存储相关问题导致的
数组的初始化方式
1.所有元素赋值{1，2，3，}类似如此
2.给出部分元素的值 其余用0来填补
3.给出所有值 可以省略最高维
二维数组
可以看成n个相同的一维数组的集合arr[][]
定义方式：与一维数组类似
赋值
1.全部赋值{{} {} {}}
2.给部分数组初始化赋值 未赋值的用0补 因为二维和一维的储存方式类似 所以赋值也类似
3.给出所有元素 可以省略最高维度
访问
用双循环访问或者整除取余的方式找到规律来对应地下标访问
字符数组
赋值初始化的方法和二维一维数组的方式不同
单个字符可用{‘ ’ ‘ ’ ‘ ’ ‘ ’}来赋值
字符串可用“”来赋值 字符串用0来表示终结 因此数组的元素数要比赋值的元素数大一
sizeof用来求数组的内存大小 strlen用来求字符数组的长度

### 函数

函数是一个实现特定功能的代码块，相同的代码可以封装成函数，写框架填值

![image-20251026110020716](E:\Typora\Theoretical knowledge.assets\image-20251026110020716.png)

函数返回值类型：
void表示空类型，即不返回结果；如果需要返回结果，需要在函数体末尾加上return和表达式返回。

函数定义：
格式：函数返回值类型 函数名（形参1类型，形参2类型，……）
{函数体
};

调用格式：函数名（实参）；

调用条件：1.函数调用前需要提前声明或定义
2.如果是库函数就需要头文件<stdio.h>（标准输入输出）
3.自定义函数需要声明或定义

### cpp区别于的一些用法

![image-20251026110228593](E:\Typora\Theoretical knowledge.assets\image-20251026110228593.png)

## GPIO

![image-20251026110729874](E:\Typora\Theoretical knowledge.assets\image-20251026110729874.png)

GPIO八大模式；

1.推挽输出：P-MOS激活，N-MOS关闭，3.3v高电平。（由芯片电压所驱动）
2.开漏输出：N-MOS工作，P-MOS一直断开，N-MOS工作，GND变为5V，。（没有驱动能力，靠外部电压源进行驱动，所以很灵活）

![image-20251026110754456](E:\Typora\Theoretical knowledge.assets\image-20251026110754456.png)

片上外设/输出寄存器  根据控制来源的不同分为普通和复用

3.复用推挽输出

4.复用开漏输出

5.浮空输入模式：GPIO口内部处于高阻态，引脚电平=3.3v，高电平。

上拉电阻：限流，防止电源与GND直接相连而短路。

 6.上拉输入

7.下拉输入

8.模拟输入 

## 中断与串口

中断

- 概念：中断是指计算机在执行期间，系统内发生任何非寻常的或非预期的急需处理事件，使得CPU暂时中断当前正在执行的程序而转去执行相应的事件处理程序，待处理完毕后又返回原来被中断处继续执行。
- 优先级：STM32的中断优先级由NVIC（嵌套向量中断控制器）管理，中断优先级寄存器NVIC_IPR的高4位被分成抢占优先级和子优先级两组。多个中断同时提出申请时，先比较抢占优先级，高的先执行；若相同，则比较子优先级；若都相同，比较中断编号，编号越小，优先级越高。
- 中断处理过程：包括按键硬件连接、GPIO配置、外部中断配置以及中断服务程序编写等步骤。

串口

- 硬件连接：STM32的串口通过UART模块实现，需连接TX、RX引脚到对应设备的RX、TX引脚，还可连接GND以保证通信稳定性。
- 参数配置：要为串口模块使能时钟，配置波特率、工作模式（如8数据位、1停止位、无奇偶校验位）等参数。
- 中断使能：串口通信可通过中断方式处理，需使能接收中断和（或）发送中断，当接收到数据时，CPU会暂停当前任务，转而执行串口中断服务程序。
- 数据收发：发送数据时将数据写入串口数据寄存器，接收数据时从串口数据寄存器中读取数据，通常还涉及缓存区的管理。

## PWM

   1.PWM核心概念与原理

- 定义：脉冲宽度调制（PWM）是一种通过周期性改变脉冲信号的高电平时间（占空比），来模拟模拟信号输出或实现功率调节的技术。
- 关键参数：
- 周期（T）：脉冲信号重复一次的时间，由定时器的计数周期决定。
- 占空比（D）：高电平时间占整个周期的比例（0%~100%），是PWM控制的核心（如占空比50%表示高低电平各占一半时间）。
- 频率（f）：周期的倒数（f=1/T），需根据被控设备特性匹配（如舵机常用50Hz，电机常用1kHz~20kHz）。
- STM32实现逻辑：通过定时器的PWM模式，将计数器值与比较值（CCR）比较，计数器小于CCR时输出高电平，大于等于时输出低电平，通过修改CCR值改变占空比。

2. STM32 PWM配置核心步骤（以HAL库为例）

1. 时钟使能：开启对应定时器（如TIM2/TIM3）和GPIO引脚的时钟，确保硬件模块供电。
2. GPIO配置：将PWM输出引脚（如PA0对应TIM2_CH1）配置为“复用推挽输出”模式，绑定定时器的复用功能。
3. 定时器基础配置：
- 选择计数模式（常用向上计数：从0计数到自动重装载值ARR后清零）。
- 设置ARR值（决定周期：ARR越大，周期越长，频率越低）和PSC预分频系数（降低时钟频率，细化周期调节）。
4. PWM模式配置：
- 选择PWM模式1（计数器<CCR时高电平）或模式2（计数器<CCR时低电平）。
- 配置比较值CCR（初始占空比对应的数值，如ARR=1000时，CCR=500对应50%占空比）。
5. 使能输出与启动定时器：使能定时器的PWM输出通道，启动定时器计数，PWM信号开始输出。

3. 实战应用场景与技巧

- 电机调速：通过改变PWM占空比调节电机两端的平均电压，占空比越高，电机转速越快（如直流电机PWM调速电路中，配合MOS管或L298N驱动模块实现）。
- 舵机角度控制：50Hz频率下，通过1ms~2ms的高电平脉冲对应舵机0°~180°转动（如CCR值对应脉冲宽度，需精确计算ARR和PSC以匹配50Hz周期）。
- 呼吸灯实现：在主循环或定时器中断中，周期性递增/递减CCR值，使LED的亮度随占空比变化呈现呼吸效果。
- 常见问题解决：
- 输出无波形：检查GPIO复用功能是否正确、定时器时钟是否使能、PWM通道是否开启。
- 占空比调节不连续：增大ARR值（如从100改为1000），提升占空比调节精度。
